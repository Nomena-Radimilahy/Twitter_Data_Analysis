---
title: "Sentiment Analysis mit VADER"
author: "Nomena Radimilahy"
date: "2023-10-24"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

```{r}
suppressPackageStartupMessages({
library(dplyr)
library(lubridate)
library("RColorBrewer") # color pallets
library("ggplot2") # reportable graphs
library(cowplot) # arranges ggplot graphs nicely
library(moments) # for calculating skeweness
library(scales) # to change the format of the scales on the axis
})
```

## 1.Überblick über den bereinigten Datensatz

Im Rahmen der Datenvorverarbeitung in Python wurden folgende Schritte zur Reinigung unternommen:

- Emojis entfernt, da sie nicht zwingend auf Emotionen hinweisen und der Datensatz viele schwer interpretierbare Emojis, wie zum Beispiel einen Kompass, enthielt.
- URLs, Erwähnungen (Mentions) und Hashtags gelöscht.
- Texte in Kleinbuchstaben konvertiert.
- Überflüssige Zeichen am Anfang und Ende der Texte eliminiert.
- Leere Tweets und zusätzliche Leerstellen zwischen den Wörtern entfernt.
- Stoppwörter herausgefiltert, da sie als häufig gebrauchte kurze Wörter wie Konjunktionen, Präpositionen und Artikel keine signifikante Sentimentzuordnung ermöglichen.

Jetzt wird die bereinigte Datei importiert, um mit der weiteren Analyse zu beginnen.


```{r}
# reading in the data
twitter <- read.csv("C:/Users/nomen/OneDrive/Desktop/Bachelorarbeit/Datenanalyse/twitter_cleaned.csv", sep = ",", header = T, stringsAsFactors = T)
```

```{r}
head(twitter)
```

Aus der Datenvorverarbeitung in Python könnten sich neue Unreinheiten wie Fehlwerte aufzeigen. Nach dem Entfernen von Inpurities, haben wir festegestellt, dass es noch redundanten Tweets in dem Datesatz gibt. Dies werden auch entfernt.

```{r}
twitter <- twitter[!duplicated(twitter$Text) & !duplicated(twitter$Text, fromLast = TRUE), ]
#head(twitter)

```


```{r}
# Fehlwerte nochmal checken
na_count <- sapply(twitter, function(x) sum(is.na(x)))
na_count

rows_with_na <- apply(twitter, 1, function(x) any(is.na(x)))
twitter[rows_with_na, ]


```

Es gibt einen Fehlwert in *CreatedAt*. 

```{r}
# Entfernen von Zeilen mit NA-Werten
twitter <- na.omit(twitter)
twitter <- twitter[!is.na(twitter$CreatedAt), ]
str(twitter)

```

Nach der Datenbereinigung und -vorverarbeitung stehen uns für unsere Analyse 45740 Datenzeilen und 8 Variablen zur Verfügung. Zuerst werfen wir einen Blick auf die Verteilung der Tweets pro Monat.

```{r}
# Konvertieren der CreatedAt-Spalte in einen datetime-Typ
twitter$CreatedAt <- ymd_hms(twitter$CreatedAt)

# Gruppieren der Daten direkt nach Jahr und Monat und Zählen der Tweets pro Monat
tweets_per_month <- twitter %>%
  group_by(YearMonth = floor_date(CreatedAt, "month")) %>%
  summarise(Count = n())

# Balkendiagramm für die Kommentare pro Monat
ggplot(tweets_per_month, aes(x = YearMonth, y = Count)) + 
  geom_bar(stat = "identity", fill = "steelblue") + 
  geom_text(aes(label=Count), vjust=-0.5, hjust=1.5) +
  labs(title = "Überblick über die Tweets pro Monat", 
       x = "Monat", 
       y = "Anzahl der Tweets") + 
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Im Vergleich zu Dezember und Januar zeigt sich, dass November und Februar weniger Tweets aufweisen. Dies liegt daran, dass sie nicht die Daten eines ganzen Monats umfassen. Obwohl die Anzahl der Tweets im ersten Monat nach der Veröffentlichung hoch war, nahm sie im Januar ab. Dennoch ist die Anzahl der Tweets im Februar beeindruckend: Innerhalb von nur sechs Tagen wurden fast 5.000 Tweets veröffentlicht. Hochgerechnet auf einen kompletten Monat könnte diese Zahl 20.000 Tweets erreichen. Ein möglicher Grund dafür könnte die Veröffentlichung eines neuen Updates oder Features sein.


## 2. Sentiment Analyse mit VADER

VADER (Valence Aware Dictionary and sEntiment Reasoner) ist ein Python-Paket, das speziell für die Sentiment-Analyse von Texten entwickelt wurde. Es ist besonders für soziale Medien und kurze Textpassagen konzipiert. VADER analysiert jeden Satz und bewertet jedes Wort individuell. Jedem Wort wird ein Wert zugeordnet, der entweder positiv, negativ oder neutral sein kann. Da VADER ein Python-Paket ist, wird die Ausführung des Algorithmus in Python durchgeführt. Die Ergebnisse werden anschließend in R importiert und visualisiert. Für die Nutzung von VADER in Python ist es notwendig, das NLTK-Paket zu importieren und 'vader_lexicon', 'averaged_perceptron_tagger', 'maxent_ne_chunker' sowie 'words' von nltk herunterzuladen.

Die Datensätze haben sich aufgrund der entdeckten Fehlwerte geändert; daher ist es notwendig, sie vor der weiteren Verarbeitung in Python neu zu speichern (Datei *twitter_final.csv*).

```{r}
# Write the data frame to a CSV file
write.csv(twitter, file = "C:/Users/nomen/OneDrive/Desktop/Bachelorarbeit/Datenanalyse/twitter_final.csv", row.names = FALSE)
```

Importieren wir nun die analysierte Datei *twitter_vader.csv*.

```{r}
vader <- read.csv("C:/Users/nomen/OneDrive/Desktop/Bachelorarbeit/Datenanalyse/twitter_vader.csv", sep = ",", header = T, stringsAsFactors = T)
head(vader)
```


## 3. Klassification

VADER liefert seine Stimmungsbewertung in vier Kategorien: zusammengesetzt **compound**, positiv (**pos**), negativ (**neg**) und neutral (**neu**). Der **compound** Wert wird berechnet, indem die Wertungsbewertungen jedes Wortes im Lexikon summiert werden, die gemäß bestimmten Regeln angepasst werden, und dann normalisiert, um zwischen -1 (extrem negativ) und +1 (extrem positiv) zu liegen. 

Für die Einteilung werden wir die **compound** Werte verwenden und die Richtlinien sind wie folgt:

- positives Gefühl oder 1 : compound > 0.05
- neutrales Gefühl oder 0 : -0.05 < compound < 0.05
- negatives Gefühl oder -1 : compound < -0.05

```{r}
vader <- vader %>% 
  mutate(Sentiment = case_when(
    compound > 0.05 ~ 1,
    compound < -0.05 ~ -1,
    TRUE ~ 0
  ))

# Reorganisiere der Spalten
vader <- vader %>% 
  relocate(Sentiment, .after = compound)
```


```{r}
# Write the data frame to a CSV file
write.csv(vader, file = "C:/Users/nomen/OneDrive/Desktop/Bachelorarbeit/Datenanalyse/vader_final.csv", row.names = FALSE)
```


## 4. Ergebnisse

```{r}
vader$Sentiment <- factor(vader$Sentiment,
                          levels = c(1, 0, -1),
                          labels = c("positive", "neutral", "negative"))

sentiment_cases <- ggplot(vader) +
                   geom_bar(aes(x = Sentiment, fill = Sentiment)) + 
                   geom_text(stat='count', aes(x=Sentiment, y=after_stat(count), label=after_stat(count)), vjust=-0.5) +
                   scale_fill_manual(values = c("positive" = "green4", "neutral" = "lightblue1", "negative" = "red1")) +
                   labs(title = "Sentiment of ChatGPT on Twitter",
                        x = "Sentiment",
                        y = "Count")

# Berechnung der Prozentwerte
sentiment_summary <- as.data.frame(table(vader$Sentiment))
names(sentiment_summary) <- c("Sentiment", "Freq")
sentiment_summary$Percentage <- round((sentiment_summary$Freq / sum(sentiment_summary$Freq) * 100), 2)

# Add label position
sentiment_summary <- sentiment_summary %>%
  arrange(desc(Sentiment)) %>%
  mutate(lab.Percentage = cumsum(Freq) - 0.5*Freq)

farbe <- c("green4", "lightblue1", "red1" )

sentiment_pie <- ggplot(sentiment_summary, aes(x = "", y = Freq, fill = Sentiment)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar("y", start = 0)+
  geom_text(aes(y = lab.Percentage, label = Percentage), color = "white")+
  scale_fill_manual(values = farbe) +
  ggtitle("Sentimentverteilung (%)") +
  theme_void()

plot_grid(sentiment_cases, sentiment_pie)

```


```{r}
vader$UserVerified <- factor(vader$UserVerified,
                levels = c(1,0),
                labels = c("verified", "not verified"))

sentiment_user <- ggplot(vader, aes(x = Sentiment, fill = UserVerified)) + 
    geom_bar(position = "dodge", width = 0.6) + 
    geom_text(stat='count', aes(group=UserVerified, label=after_stat(count)), vjust=-0.5, position=position_dodge(width=0.6)) + 
    scale_fill_manual(values = c("verified" = "dodgerblue4", "not verified" = "coral")) + 
    labs(title = "Sentiment of ChatGPT on Twitter",
         x = "Sentiment",
         y = "Count",
         fill = "User Status") + # Legende für "fill" benennen
    theme(plot.title = element_text(color = "royalblue4", size = 12, face = "bold"),
          plot.caption = element_text(face = "italic"))

sentiment_user
```

ChatGPT hat sich seit seiner Veröffentlichung erfolgreich in der Gesellschaft positioniert. Dies wird besonders durch die überwiegend positiven Rückmeldungen der ersten Nutzer evident. Über die Hälfte (59%) der erfassten Tweets drücken positive Gefühle gegenüber dieser KI aus. Ein Drittel (26,81%) der Tweets bleibt neutral, während ein nicht zu vernachlässigender Anteil von 14,16% negative Emotionen zeigt. Auffällig ist, dass die Mehrheit der Tweets von nicht verifizierten Konten stammen.


```{r}
# Konvertieren der CreatedAt-Spalte in einen datetime-Typ
vader$CreatedAt <- ymd_hms(vader$CreatedAt)

# Filtern der Tweets pro Monat
nov_tweets <- vader %>% filter(month(CreatedAt) == 11)
dec_tweets <- vader %>% filter(month(CreatedAt) == 12)
jan_tweets <- vader %>% filter(month(CreatedAt) == 01)
feb_tweets <- vader %>% filter(month(CreatedAt) == 02)

# Visualisierung
nov_bar <- ggplot(nov_tweets) +
                   geom_bar(aes(x = Sentiment, fill = Sentiment)) + 
                   geom_text(stat='count', aes(x=Sentiment, y=after_stat(count), label=after_stat(count)), vjust=-0.5) +
                   scale_fill_manual(values = c("positive" = "green4", "neutral" = "lightblue1", "negative" = "red1")) +
                   labs(title = "Sentiments im November",
                        x = "Sentiment",
                        y = "Count")

dec_bar <- ggplot(dec_tweets) +
                   geom_bar(aes(x = Sentiment, fill = Sentiment)) + 
                   geom_text(stat='count', aes(x=Sentiment, y=after_stat(count), label=after_stat(count)), vjust=-0.5) +
                   scale_fill_manual(values = c("positive" = "green4", "neutral" = "lightblue1", "negative" = "red1")) +
                   labs(title = "Sentiments im Dezember",
                        x = "Sentiment",
                        y = "Count")

jan_bar <- ggplot(jan_tweets) +
                   geom_bar(aes(x = Sentiment, fill = Sentiment)) + 
                   geom_text(stat='count', aes(x=Sentiment, y=after_stat(count), label=after_stat(count)), vjust=-0.5) +
                   scale_fill_manual(values = c("positive" = "green4", "neutral" = "lightblue1", "negative" = "red1")) +
                   labs(title = "Sentiments im Januar",
                        x = "Sentiment",
                        y = "Count")

feb_bar <- ggplot(feb_tweets) +
                   geom_bar(aes(x = Sentiment, fill = Sentiment)) + 
                   geom_text(stat='count', aes(x=Sentiment, y=after_stat(count), label=after_stat(count)), vjust=-0.5) +
                   scale_fill_manual(values = c("positive" = "green4", "neutral" = "lightblue1", "negative" = "red1")) +
                   labs(title = "Sentiments im Februar",
                        x = "Sentiment",
                        y = "Count")

# Berechnung der Prozentwerte
nov_summary <- as.data.frame(table(nov_tweets$Sentiment))
names(nov_summary) <- c("Sentiment", "Freq")
nov_summary$Percentage <- round((nov_summary$Freq / sum(nov_summary$Freq) * 100), 2)

dec_summary <- as.data.frame(table(dec_tweets$Sentiment))
names(dec_summary) <- c("Sentiment", "Freq")
dec_summary$Percentage <- round((dec_summary$Freq / sum(dec_summary$Freq) * 100), 2)

jan_summary <- as.data.frame(table(jan_tweets$Sentiment))
names(jan_summary) <- c("Sentiment", "Freq")
jan_summary$Percentage <- round((jan_summary$Freq / sum(jan_summary$Freq) * 100), 2)

feb_summary <- as.data.frame(table(feb_tweets$Sentiment))
names(feb_summary) <- c("Sentiment", "Freq")
feb_summary$Percentage <- round((feb_summary$Freq / sum(feb_summary$Freq) * 100), 2)


# label position berechnen (lab.percentage) 
nov_summary <- nov_summary %>%
  arrange(desc(Sentiment)) %>%
  mutate(lab.Percentage = cumsum(Freq) - 0.5*Freq)

dec_summary <- dec_summary %>%
  arrange(desc(Sentiment)) %>%
  mutate(lab.Percentage = cumsum(Freq) - 0.5*Freq)

jan_summary <- jan_summary %>%
  arrange(desc(Sentiment)) %>%
  mutate(lab.Percentage = cumsum(Freq) - 0.5*Freq)

feb_summary <- feb_summary %>%
  arrange(desc(Sentiment)) %>%
  mutate(lab.Percentage = cumsum(Freq) - 0.5*Freq)

november_pie <- ggplot(nov_summary, aes(x = "", y = Freq, fill = Sentiment)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar("y", start = 0)+
  geom_text(aes(y = lab.Percentage, label = Percentage), color = "white")+
  scale_fill_manual(values = farbe) +
  ggtitle("Sentimentverteilung (%)") +
  theme_void()

december_pie <- ggplot(dec_summary, aes(x = "", y = Freq, fill = Sentiment)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar("y", start = 0)+
  geom_text(aes(y = lab.Percentage, label = Percentage), color = "white")+
  scale_fill_manual(values = farbe) +
  ggtitle("Sentimentverteilung (%)") +
  theme_void()

januar_pie <- ggplot(jan_summary, aes(x = "", y = Freq, fill = Sentiment)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar("y", start = 0)+
  geom_text(aes(y = lab.Percentage, label = Percentage), color = "white")+
  scale_fill_manual(values = farbe) +
  ggtitle("Sentimentverteilung (%)") +
  theme_void()

februar_pie <- ggplot(feb_summary, aes(x = "", y = Freq, fill = Sentiment)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar("y", start = 0)+
  geom_text(aes(y = lab.Percentage, label = Percentage), color = "white")+
  scale_fill_manual(values = farbe) +
  ggtitle("Sentimentverteilung (%)") +
  theme_void()

plot_grid(nov_bar, november_pie)

```

```{r}
plot_grid(dec_bar, december_pie)
```

```{r}
plot_grid(jan_bar, januar_pie)
```

```{r}
plot_grid(feb_bar, februar_pie)
```

Wie bereits erwähnt, nimmt die Anzahl der Tweets nach dem ersten Monat ab, um dann im Februar wieder anzusteigen. Dieses Muster spiegelt sich in allen drei Sentiments wider, was angesichts der gesamten Tweet-Anzahl auch zu erwarten ist. Interessant ist jedoch die konstante Verteilung der Sentiments über die Monate hinweg. Der Anteil an positiven Sentiments bewegt sich zwischen 54% und 59%, bei negativen Sentiments zwischen 13% und 17%, und neutrale Sentiments liegen zwischen 26% und 31%. Besonders hervorzuheben ist der deutliche Anstieg des Anteils an neutralen Tweets im Februar.

